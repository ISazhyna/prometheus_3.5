.PHONY: clean

# Define the target platforms and architectures
PLATFORMS := linux darwin windows
ARCHITECTURES := amd64 386 arm64

# Define the output directory for the binaries
OUTDIR := bin

# Define the main target
all: $(PLATFORMS)

# Define the targets for each platform
$(PLATFORMS):
	@echo "Building for platform: $@"
	@$(MAKE) $(OUTDIR)/$@_$(ARCHITECTURE)/myapp

# Define the targets for each platform and architecture combination
$(foreach PLATFORM,$(PLATFORMS),$(foreach ARCH,$(ARCHITECTURES),$(eval $(call TARGET,$(PLATFORM),$(ARCH)))))

# Function to define the target for a specific platform and architecture combination
define TARGET
$(OUTDIR)/$(1)_$(2)/myapp:
	GOOS=$(1) GOARCH=$(2) go build -o $$@ ./myapp
endef

# Clean the output directory
clean:
	@echo "Cleaning up..."
	@rm -rf $(OUTDIR)
